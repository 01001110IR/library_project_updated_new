<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<img id="im" src="/static/logo.png" alt="">
<div class="container mt-5">
    <!-- Section for Adding Books -->
    <h2>Add Book</h2>
    <form id="add-book-form" class="mb-4">
        <input type="text" id="book-name" placeholder="Name" required>
        <input type="text" id="book-author" placeholder="Author" required>
        <input type="text" id="book-published-year" placeholder="Published Year" required>
        <input type="number" id="book-type" placeholder="Book Type" required>
        <select id="book-active">
            <option value="available">Available</option>
            <option value="unavailable">Unavailable</option>
        </select>
        <button type="submit" class="btn btn-primary">Add Book</button>
        
    </form>

    <!-- Table for Displaying Books -->
    <h2>Library Books</h2>
    <table id="books-table" class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Author</th>
                <th>Published Year</th>
                <th>Book Type</th>
                <th>Active</th>
                <th>ID</th>
            </tr>
        </thead>
        <tbody>
            <!-- Book items will be added here dynamically -->
        </tbody>
    </table>

    <!-- Section for Adding Customers -->
    <h2>Add Customer</h2>
    <form id="add-customer-form" class="mb-4">
        <input type="text" id="customer-name" placeholder="Name" required>
        <input type="number" id="customer-age" placeholder="Age" required>
        <input type="text" id="customer-city" placeholder="City" required>
        <button type="submit" class="btn btn-primary">Add Customer</button>
        <button id="delete-customer-button">del </button>

    </form>

    <!-- Table for Displaying Customers -->
    <h2>Customers</h2>
    <table id="customers-table" class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Age</th>
                <th>City</th>
                <th>ID</th>
            </tr>
        </thead>
        <tbody>
            <!-- Customer items will be added here dynamically -->
        </tbody>
    </table>

    <!-- Section for Adding Loans -->
    <h2>Add Loan</h2>
    <form id="add-loan-form" class="mb-4">
        <input type="number" id="loan-book-id" placeholder="Book ID" required>
        <input type="number" id="loan-customer-id" placeholder="Customer ID" required>
        <input type="date" id="loan-date" placeholder="Loan Date" required>
        <button type="submit" class="btn btn-primary">Create Loan</button>
    </form>

    <!-- Table for Displaying Loans -->
    <h2>Loans</h2>
    <table id="loans-table" class="table">
        <thead>
            <tr>
                <th>Loan ID</th>
                <th>Book ID</th>
                <th>Customer ID</th>
                <th>Loan Date</th>
                <th>Return Date</th>
                <th>Return Date</th>
                <th>Max Return Date</th>
            </tr>
        </thead>
        <tbody>
            <!-- Loan items will be added here dynamically -->
        </tbody>
    </table>
</div>

<!-- Bootstrap JS and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

<!-- Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
      const SERVER_URL = 'http://127.0.0.1:7500'; // Your server URL
  
      // Function to fetch and display books
      async function displayBooks() {
          try {
              const response = await axios.get(`${SERVER_URL}/books`); console.log(response.data);
              const books = response.data;
              const booksTable = document.getElementById('books-table').getElementsByTagName('tbody')[0];
              booksTable.innerHTML = ''; // Clear existing entries
              books.forEach(book => {console.log(books);
                  let row = booksTable.insertRow();
                  row.innerHTML = `
                      <td>${book.name}</td>
                      <td>${book.author}</td>
                      <td>${book.published_Year}</td>
                      <td>${book.book_Type}</td>
                      <td>${book.active}</td>
                      <td>${book.id}</td>
                  `;
              });
          } catch (error) {
              console.error('Error fetching books:', error);
          }
      }
      document.getElementById('add-book-form').addEventListener('submit', async function(event) {
    event.preventDefault();
    
    // Collect book data from the form
    const bookData = {
        name: document.getElementById('book-name').value,
        author: document.getElementById('book-author').value,
        published_Year: document.getElementById('book-published-year').value,
        book_Type: document.getElementById('book-type').value,
        active: document.getElementById('book-active').value
    };

    try {
        await axios.post(`${SERVER_URL}/books`, bookData);
        displayBooks(); // Refresh the list of books
        showMessage(`Book '${bookData.name}' added successfully!`, true);
    } catch (error) {
        console.error('Error adding book:', error);
        showMessage('Error adding book. Please try again.', false);
    }
});
   
      // Function to fetch and display customers
      async function displayCustomers() {
    try {
        const response = await axios.get(`${SERVER_URL}/customers`);
        const customers = response.data;
        const customersTable = document.getElementById('customers-table').getElementsByTagName('tbody')[0];
        customersTable.innerHTML = ''; // Clear existing entries
        customers.forEach(customer => {
            let row = customersTable.insertRow();
            row.innerHTML = `
                <td>${customer.name}</td>
                <td>${customer.age}</td>
                <td>${customer.city}</td>
                <td>${customer.customer_id}</td> <!-- Added this line to display book ID -->
            `;
        });
    } catch (error) {
        console.error('Error fetching customers:', error);
    }
}
// Function to handle form submission for adding a customer
document.getElementById('add-customer-form').addEventListener('submit', async function(event) {
    event.preventDefault();
    
    // Collect customer data from the form
    const customerData = {
        name: document.getElementById('customer-name').value,
        age: document.getElementById('customer-age').value,
        city: document.getElementById('customer-city').value
    };

    try {
        await axios.post(`${SERVER_URL}/customers`, customerData);
        displayCustomers(); // Refresh the list of customers
    } catch (error) {
        console.error('Error adding customer:', error);
    }
});



// Function to fetch and display loans
async function displayLoans() {
    try {
        const response = await axios.get(`${SERVER_URL}/loans`);
        const loans = response.data;
        const loansTable = document.getElementById('loans-table').getElementsByTagName('tbody')[0];
        loansTable.innerHTML = ''; // Clear existing entries
        loans.forEach(loan => {
        let row = loansTable.insertRow();
        row.innerHTML = `
            <td>${loan.id}</td>
            <td>${loan.book_id}</td>
            <td>${loan.customer_id}</td>
            <td>${loan.loan_date}</td>
            <td>${loan.returnDate || ''}</td>
            <td>${loan.maxReturnDate || ''}</td> <!-- Display maxReturnDate -->
        `;
    });
    } catch (error) {
        console.error('Error fetching loans:', error);
    }
}


// Function to handle form submission for creating a loan
document.getElementById('add-loan-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        // Collect loan data from the form
        const loanData = {
            book_id: document.getElementById('loan-book-id').value,
            customer_id: document.getElementById('loan-customer-id').value,
            loan_date: document.getElementById('loan-date').value
        };

        try {
            const response = await axios.post(`${SERVER_URL}/loans`, loanData);
            
            // Check the response status
            if (response.status === 201) {
                // Loan created successfully
                displayLoans(); // Refresh the list of loans
                alert('Loan created successfully!');
            } else {
                // Handle other statuses as needed
                alert('Unexpected response from the server.');
            }
        } catch (error) {
            if (error.response && error.response.status === 400) {
                // Handle specific error (e.g., book not available)
                alert('Error: ' + error.response.data.error);
            } else {
                // Handle general errors
                console.error('Error creating loan:', error);
                alert('Error creating loan. Please try again.');
            }
        }
    });

// Initial data load for all entities
displayBooks();
displayCustomers();
displayLoans();


  </script>
</body>
</html>
